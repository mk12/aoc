# Copyright 2022 Mitchell Kember. Subject to the MIT License.
# Advent of Code 2022
# Day 11: Monkey in the Middle

âŸ¨Cut, Lines, N, SplitâŸ© â† â€¢Import "common.bqn"

# Helper functions for parsing.
ParseArg â† {ğ•©â‰¡"old" ? âŠ¢ ; Nğ•©}
ParseExpr â† {âŸ¨x,f,yâŸ©â†(' 'âŠ¸=)Â¨âŠ¸Splitğ•© â‹„ (ParseArg x)âŠ¸(+â€¿Ã—âŠ‘Ëœ"+*"âŠf)âŸœ(ParseArg y)}

# Lists of starting items for each monkey, and a table where each row contains
# four elements: operation, test divisor, and throwing index for true/false.
initâ€¿table â† âŠË˜âŠ¸â‹ˆâŸœ(1âŠ¸â†“Ë˜)âŸ¨
  NÂ¨Â·(âˆ¨Ë" ,"=âŒœâŠ¢)âŠ¸Cut 18âŠ¸â†“, ParseExpr 19âŠ¸â†“, N 21âŠ¸â†“, N 29âŠ¸â†“, N 30âŠ¸â†“
âŸ©âŠ¸(âŠ£{ğ•ğ•©}Â¨(1+â†•5)âŠ¸âŠ)Ë˜ â†‘â€¿7 â¥Š Lines "2022_11"

# Inspects item ğ•© given monkey table info ğ•¨, returning the new worry level and destination index.
I â† {fâ€¿dâ€¿tâ€¿eâ†ğ•¨ â‹„ (âŠ¢â‹ˆeâ€¿tâŠ‘Ëœ0=d|âŠ¢)âŒŠ3Ã·Ëœfâ—‹âŠ¢ğ•©}

# Runs a turn on items ğ•© given monkey info ğ•¨, returning partial list of items.
T â† {(((â‰ table)âˆ¾Ëœ(1âŠ¸âŠ‘)Â¨)âŠ”âŠ‘Â¨) ğ•¨âŠ¸IÂ¨ğ•©}
(âŠtable)T âŸ¨79,98âŸ©
(1âŠtable)T âŸ¨54,65,75,74âŸ©

R â† {
  ğ•©{
    # ğ•¨ is index, ğ•© is stateâ€¿nums
    sâ€¿nâ†ğ•©
    âŸ¨
      (0âŠ¸â†‘âŒ¾(ğ•¨âŠ¸âŠ‘)s)âˆ¾Â¨(ğ•¨âŠtable)T(ğ•¨âŠ‘s)
      (â‰ ğ•¨âŠ‘s)âŠ¸+âŒ¾(ğ•¨âŠ¸âŠ‘)n
    âŸ©
  }Â´âŒ½â†•â‰ âŠ‘ğ•©
}

# Part 1
â€¢Out Ã—Â´2â†‘âˆ¨1âŠ‘RâŸ20(âŠ¢â‹ˆâ‰ â¥Š0Ë™)init

# Part 2
â€¢Out 2


##########
## index T entire_state
# T â† {
#   fâ€¿dâ€¿tâ€¿e â† ğ•¨ âŠ table
#   iâ€¿n â† ğ•©
#   ()Â¨i
# }

# R entire_state
# R â† {
#   ğ•©TÂ´âŒ½â†•â‰ ğ•©
# }
